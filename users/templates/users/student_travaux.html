{% extends 'users/base.html' %}
{% load static %}

{% block title %}Mes Travaux - MyUOM{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0" style="color: var(--uom-blue);">
      <i class="bi bi-file-earmark-text"></i> Mes Travaux
    </h2>
    <div>
      {% if niveau_etudiant %}
        <span class="badge bg-primary">Niveau: {{ niveau_etudiant }}</span>
      {% endif %}
    </div>
  </div>
  
  <!-- Information sur le filtrage -->
  <div class="alert alert-info mb-4">
    <i class="bi bi-info-circle"></i>
    <strong>Filtrage automatique :</strong> 
    Seuls les travaux des cours correspondant à votre niveau ({{ niveau_etudiant|default:"N/A" }), 
    votre promotion et votre faculté sont affichés.
  </div>

  <!-- Travaux ouverts -->
  <div class="col-12">
    <div class="card card-uom">
      <div class="card-header card-header-uom">
        <i class="bi bi-unlock"></i> Travaux ouverts (à faire ou en cours de correction)
      </div>
      <div class="card-body">
        {% if travaux_ouverts %}
          <div class="list-group">
            {% for travail, remise in travaux_ouverts %}
            <div class="list-group-item d-flex justify-content-between align-items-center">
              <div class="flex-grow-1">
                <h5 class="mb-1" style="color: var(--uom-blue);">{{ travail.titre }}</h5>
                <p class="mb-1 text-muted">
                  <i class="bi bi-book"></i> {{ travail.cours.titre }} ({{ travail.cours.code }})
                  <br>
                  <i class="bi bi-person"></i> {{ travail.cours.enseignant.get_full_name|default:travail.cours.enseignant.username }}
                </p>
                <small class="text-muted">
                  <i class="bi bi-clock"></i> Date limite: {{ travail.date_limite_remise|date:"d/m/Y H:i" }}
                  {% if remise %}
                    <span class="badge bg-warning ms-2">Remis (en attente de correction)</span>
                  {% else %}
                    <span class="badge bg-primary ms-2">À faire</span>
                  {% endif %}
                </small>
              </div>
              <div class="ms-3">
                {% if remise %}
                  <a href="#" class="btn btn-sm btn-outline-warning me-2">
                    <i class="bi bi-eye"></i> Voir remise
                  </a>
                {% else %}
                  <a href="#" class="btn btn-sm btn-uom-primary">
                    <i class="bi bi-upload"></i> Rendre
                  </a>
                {% endif %}
              </div>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="alert alert-info text-center">
            <i class="bi bi-info-circle"></i>
            Aucun travail ouvert pour le moment.
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Travaux terminés -->
  <div class="col-12">
    <div class="card card-uom">
      <div class="card-header card-header-uom">
        <i class="bi bi-check-circle"></i> Travaux terminés (corrigés ou notés)
      </div>
      <div class="card-body">
        {% if travaux_termines %}
          <div class="list-group">
            {% for travail, remise in travaux_termines %}
            <div class="list-group-item d-flex justify-content-between align-items-center">
              <div class="flex-grow-1">
                <h5 class="mb-1" style="color: var(--uom-blue);">{{ travail.titre }}</h5>
                <p class="mb-1 text-muted">
                  <i class="bi bi-book"></i> {{ travail.cours.titre }} ({{ travail.cours.code }})
                </p>
                <small class="text-muted">
                  <i class="bi bi-check-circle"></i> Corrigé le: {{ remise.date_correction|date:"d/m/Y H:i" }}
                  <span class="badge bg-success ms-2">Noté: {{ remise.note|default:"N/A" }}/{{ travail.note_maximale }}</span>
                </small>
              </div>
              <div class="ms-3">
                <a href="#" class="btn btn-sm btn-outline-success">
                  <i class="bi bi-journal-check"></i> Voir correction
                </a>
              </div>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="alert alert-info text-center">
            <i class="bi bi-info-circle"></i>
            Aucun travail terminé pour le moment.
          </div>
        {% endif %}
      </div>
    </div>
  </div>
  
  <!-- Travaux fermés (non rendus) -->
  <div class="col-12">
    <div class="card card-uom">
      <div class="card-header card-header-uom">
        <i class="bi bi-lock"></i> Travaux fermés (non rendus)
      </div>
      <div class="card-body">
        {% if travaux_fermes %}
          <div class="list-group">
            {% for travail, remise in travaux_fermes %}
            <div class="list-group-item d-flex justify-content-between align-items-center">
              <div class="flex-grow-1">
                <h5 class="mb-1" style="color: var(--uom-blue);">{{ travail.titre }}</h5>
                <p class="mb-1 text-muted">
                  <i class="bi bi-book"></i> {{ travail.cours.titre }} ({{ travail.cours.code }})
                </p>
                <small class="text-muted">
                  <i class="bi bi-clock-history"></i> Date limite dépassée: {{ travail.date_limite_remise|date:"d/m/Y H:i" }}
                  <span class="badge bg-danger ms-2">Fermé</span>
                </small>
              </div>
              <div class="ms-3">
                <button class="btn btn-sm btn-outline-secondary" disabled>
                  <i class="bi bi-info-circle"></i> Détails
                </button>
              </div>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="alert alert-info text-center">
            <i class="bi bi-info-circle"></i>
            Aucun travail fermé pour le moment.
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
