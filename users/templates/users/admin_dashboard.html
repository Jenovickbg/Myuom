{% extends 'users/base.html' %}

{% block title %}Tableau de bord Administrateur - MyUOM{% endblock %}

{# Les liens de navigation sont déjà définis dans le template de base #}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h2 style="color: var(--uom-blue);">
            <i class="bi bi-speedometer2"></i> Tableau de bord Administrateur
        </h2>
        <p class="text-uom-gray">Vue d'ensemble du système MyUOM</p>
        <hr>
    </div>
</div>

<!-- Statistiques -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card card-uom text-center">
            <div class="card-body">
                <i class="bi bi-people-fill" style="font-size: 3rem; color: var(--uom-blue);"></i>
                <h3 class="mt-3" style="color: var(--uom-blue);">{{ total_students }}</h3>
                <p class="text-uom-gray mb-0">Étudiants</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card card-uom text-center">
            <div class="card-body">
                <i class="bi bi-person-workspace" style="font-size: 3rem; color: var(--uom-yellow);"></i>
                <h3 class="mt-3" style="color: var(--uom-blue);">{{ total_teachers }}</h3>
                <p class="text-uom-gray mb-0">Enseignants</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card card-uom text-center">
            <div class="card-body">
                <i class="bi bi-check-circle-fill" style="font-size: 3rem; color: #28a745;"></i>
                <h3 class="mt-3" style="color: var(--uom-blue);">{{ active_students }}</h3>
                <p class="text-uom-gray mb-0">Comptes actifs</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card card-uom text-center">
            <div class="card-body">
                <i class="bi bi-clock-fill" style="font-size: 3rem; color: var(--uom-red);"></i>
                <h3 class="mt-3" style="color: var(--uom-blue);">{{ pending_first_login }}</h3>
                <p class="text-uom-gray mb-0">En attente 1ère connexion</p>
            </div>
        </div>
    </div>
</div>

<!-- Statistiques facultés et promotions -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card card-uom text-center">
            <div class="card-body">
                <i class="bi bi-building" style="font-size: 3rem; color: var(--uom-blue);"></i>
                <h3 class="mt-3" style="color: var(--uom-blue);">{{ total_facultes }}</h3>
                <p class="text-uom-gray mb-0">Facultés</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card card-uom text-center">
            <div class="card-body">
                <i class="bi bi-calendar3" style="font-size: 3rem; color: var(--uom-yellow);"></i>
                <h3 class="mt-3" style="color: var(--uom-blue);">{{ total_promotions }}</h3>
                <p class="text-uom-gray mb-0">Promotions</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card card-uom text-center">
            <div class="card-body">
                <i class="bi bi-check-circle-fill" style="font-size: 3rem; color: #28a745;"></i>
                <h3 class="mt-3" style="color: var(--uom-blue);">{{ active_facultes }}</h3>
                <p class="text-uom-gray mb-0">Facultés actives</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card card-uom text-center">
            <div class="card-body">
                <i class="bi bi-check-circle-fill" style="font-size: 3rem; color: #28a745;"></i>
                <h3 class="mt-3" style="color: var(--uom-blue);">{{ active_promotions }}</h3>
                <p class="text-uom-gray mb-0">Promotions actives</p>
            </div>
        </div>
    </div>
</div>

<!-- Actions rapides -->
<div class="row">
    <div class="col-12">
        <h4 style="color: var(--uom-blue);"><i class="bi bi-lightning-fill"></i> Actions rapides</h4>
        <hr>
    </div>
</div>

<div class="row">
    <div class="col-md-4 mb-3">
        <div class="card card-uom h-100">
            <div class="card-body">
                <h5 style="color: var(--uom-blue);"><i class="bi bi-person-plus-fill"></i> Gestion des étudiants</h5>
                <p class="text-uom-gray">Créer, modifier et gérer les comptes étudiants</p>
                <div class="d-grid gap-2">
                    <a href="{% url 'admin_student_create' %}" class="btn btn-uom-primary">
                        <i class="bi bi-plus-circle"></i> Créer un étudiant
                    </a>
                    <a href="{% url 'admin_student_bulk_import' %}" class="btn btn-uom-secondary">
                        <i class="bi bi-file-earmark-arrow-up"></i> Importer (CSV)
                    </a>
                    <a href="{% url 'admin_student_list' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-list-ul"></i> Liste des étudiants
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-3">
        <div class="card card-uom h-100">
            <div class="card-body">
                <h5 style="color: var(--uom-blue);"><i class="bi bi-person-workspace"></i> Gestion des enseignants</h5>
                <p class="text-uom-gray">Créer et gérer les comptes enseignants</p>
                <div class="d-grid gap-2">
                    <a href="{% url 'admin_teacher_create' %}" class="btn btn-uom-primary">
                        <i class="bi bi-plus-circle"></i> Créer un enseignant
                    </a>
                    <a href="{% url 'admin_teacher_list' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-list-ul"></i> Liste des enseignants
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-3">
        <div class="card card-uom h-100">
            <div class="card-body">
                <h5 style="color: var(--uom-blue);"><i class="bi bi-journal-text"></i> Mémoires</h5>
                <p class="text-uom-gray">Gestion des mémoires de fin d'études (L3 et M2)</p>
                <div class="d-grid gap-2">
                    <a href="{% url 'memoires:admin_memoires_list' %}" class="btn btn-uom-primary">
                        <i class="bi bi-list-ul"></i> Voir tous les mémoires
                    </a>
                    <a href="{% url 'memoires:admin_memoires_list' %}?statut=soumis" class="btn btn-warning">
                        <i class="bi bi-clock"></i> En attente de validation
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-3">
        <div class="card card-uom h-100">
            <div class="card-body">
                <h5 style="color: var(--uom-blue);"><i class="bi bi-building"></i> Gestion des facultés</h5>
                <p class="text-uom-gray">Créer et gérer les facultés de l'université</p>
                <div class="d-grid gap-2">
                    <a href="{% url 'admin_faculte_management' %}" class="btn btn-uom-primary">
                        <i class="bi bi-gear"></i> Gérer les facultés
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-3">
        <div class="card card-uom h-100">
            <div class="card-body">
                <h5 style="color: var(--uom-blue);"><i class="bi bi-calendar3"></i> Gestion des promotions</h5>
                <p class="text-uom-gray">Créer et gérer les promotions académiques</p>
                <div class="d-grid gap-2">
                    <a href="{% url 'admin_faculte_management' %}" class="btn btn-uom-primary">
                        <i class="bi bi-gear"></i> Gérer les promotions
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Section Mémoires en attente -->
<div class="row mt-4">
    <div class="col-12">
        <h4 style="color: var(--uom-blue);"><i class="bi bi-journal-check"></i> Mémoires en attente de validation</h4>
        <hr>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card card-uom">
            <div class="card-body">
                <div id="memoires-en-attente">
                    <p class="text-center text-muted">Chargement...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Charger les mémoires en attente via AJAX
document.addEventListener('DOMContentLoaded', function() {
    fetch("{% url 'memoires:admin_memoires_list' %}?statut=soumis")
        .then(response => response.text())
        .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const table = doc.querySelector('.table-responsive');
            const container = document.getElementById('memoires-en-attente');
            
            if (table) {
                container.innerHTML = table.outerHTML;
            } else {
                container.innerHTML = '<p class="text-center text-muted">Aucun mémoire en attente</p>';
            }
        })
        .catch(error => {
            console.error('Erreur:', error);
            document.getElementById('memoires-en-attente').innerHTML = '<p class="text-center text-danger">Erreur de chargement</p>';
        });
});
</script>
</div>
{% endblock %}

